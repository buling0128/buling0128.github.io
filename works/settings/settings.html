<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>布灵的创作空间 - 设定集</title>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/style.css">
    <style>
        /* 新增：目录和版本板块的样式，确保显示美观 */
        .toc-container {
            background-color: #f0f7ff;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 3px solid #90caf9;
        }
        .toc-title {
            font-size: 1.2rem;
            color: #1976d2;
            margin-bottom: 10px;
            font-weight: 600;
        }
        .toc-list {
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .toc-item a {
            color: #2196f3;
            text-decoration: none;
            padding: 5px 12px;
            background-color: #e3f2fd;
            border-radius: 20px;
            transition: all 0.3s ease;
        }
        .toc-item a:hover {
            background-color: #bbdefb;
            color: #1565c0;
        }
        .version-section {
            margin: 30px 0;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(144, 202, 249, 0.2);
        }
        .version-title {
            font-size: 1.3rem;
            color: #1976d2;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e3f2fd;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="works-container">
            <h2 class="works-title">设定集</h2>
            
            <div class="works-grid">
                <!-- 因赛美那（绑定IP文件夹名yinsaimeina） -->
                <div class="work-card">
                    <img src="../../images/card.jpg" alt="因赛美那" class="work-card-image">
                    <div class="work-card-content">
                        <h3 class="work-card-title">因赛美那</h3>
                        <p class="work-card-description">这是我的原创角色因赛美那的设定集，包含原初版、15版等6个版本的完整设定。</p>
                        <button class="work-card-button" onclick="loadSetting('yinsaimeina')">查看详情</button>
                    </div>
                </div>
                
                <!-- 樱之都奈樱（绑定IP文件夹名sakura） -->
                <div class="work-card">
                    <img src="../../images/card.jpg" alt="樱之都·奈樱" class="work-card-image">
                    <div class="work-card-content">
                        <h3 class="work-card-title">樱之都·奈樱</h3>
                        <p class="work-card-description">樱之都·奈樱的设定集，包含所有版本的世界观背景、角色来历、角色人设等内容。</p>
                        <button class="work-card-button" onclick="loadSetting('yingzhidu')">查看详情</button>
                    </div>
                </div>
                
                <!-- 妖鬼街（绑定IP文件夹名yaoguijie） -->
                <div class="work-card">
                    <img src="../../images/card.jpg" alt="妖鬼街" class="work-card-image">
                    <div class="work-card-content">
                        <h3 class="work-card-title">妖鬼街</h3>
                        <p class="work-card-description">妖鬼街的设定集，包含所有版本的世界观背景、角色来历、角色人设等内容。</p>
                        <button class="work-card-button" onclick="loadSetting('yaoguijie')">查看详情</button>
                    </div>
                </div>
                
                <!-- 陀罗少女（绑定IP文件夹名tuoluoshaonv） -->
                <div class="work-card">
                    <img src="../../images/card.jpg" alt="陀罗少女" class="work-card-image">
                    <div class="work-card-content">
                        <h3 class="work-card-title">陀罗少女</h3>
                        <p class="work-card-description">陀罗少女的设定集，包含所有版本的世界观背景、角色来历、角色人设等内容。</p>
                        <button class="work-card-button" onclick="loadSetting('tuoluoshaonv')">查看详情</button>
                    </div>
                </div>
            </div>
            
            <!-- 作品详情展示区域：新增目录容器和版本容器 -->
            <div id="workDetail" class="work-detail-container" style="display: none;">
                <div class="loading" id="loading">
                    <div class="loading-spinner"></div>
                </div>
                
                <div id="workContent" style="display: none;">
                    <h2 class="work-detail-title" id="detailTitle"></h2>
                    
                    <div class="work-detail-content">
                        <div class="work-detail-image">
                            <img id="detailImage" src="" alt="作品图片">
                        </div>
                        
                        <div class="work-detail-info">
                            <!-- 1. 渲染基础信息（创作时间、类型等） -->
                            <div class="work-detail-meta" style="margin-bottom: 20px;">
                                <div class="work-detail-meta-item">
                                    <span class="work-detail-meta-label">创作时间：</span>
                                    <span id="detailTime"></span>
                                </div>
                                <div class="work-detail-meta-item">
                                    <span class="work-detail-meta-label">类型：</span>
                                    <span id="detailType"></span>
                                </div>
                                <div class="work-detail-meta-item">
                                    <span class="work-detail-meta-label">状态：</span>
                                    <span id="detailStatus"></span>
                                </div>
                            </div>
                            
                            <!-- 2. 渲染目录（新增折叠按钮） -->
<div class="toc-container" id="tocContainer">
    <!-- 移动端折叠按钮（默认显示在小屏幕） -->
    <button class="toc-toggle" id="tocToggle">
        <span>目录</span>
        <i class="fa fa-chevron-down"></i>
    </button>
    <!-- 目录标题和列表将由JS动态生成 -->
</div>
                            
                            
                            <!-- 3. 渲染多版本内容（新增） -->
                            <div class="versions-container" id="versionsContainer"></div>
                        </div>
                    </div>
                </div>
                
                <div class="error" id="error" style="display: none;">
                    <p>加载作品详情失败，请稍后再试。</p>
                </div>
            </div>
        </div>
    </div>

    <script src="../../js/navbar.js"></script>
    <script>
        /**
 * 加载指定IP的设定内容（含固定目录逻辑）
 * @param {string} settingKey - IP文件夹名称（如yinsaimeina）
 */
function loadSetting(settingKey) {
    const workDetail = document.getElementById('workDetail');
    const loading = document.getElementById('loading');
    const workContent = document.getElementById('workContent');
    const error = document.getElementById('error');
    const tocContainer = document.getElementById('tocContainer');
    const tocToggle = document.getElementById('tocToggle'); // 移动端折叠按钮

    // 显示加载动画
    workDetail.style.display = 'block';
    loading.style.display = 'flex';
    workContent.style.display = 'none';
    error.style.display = 'none';

    // 异步加载JSON文件
    fetch(`data/${settingKey}/setting.json`)
        .then(response => {
            if (!response.ok) throw new Error(`文件未找到：data/${settingKey}/setting.json`);
            return response.json();
        })
        .then(settingData => {
            // 1. 渲染基础信息（标题、图片等）- 保持不变
            document.getElementById('detailTitle').textContent = settingData.title;
            document.getElementById('detailImage').src = settingData.image;
            document.getElementById('detailImage').alt = settingData.title;
            document.getElementById('detailTime').textContent = settingData.time;
            document.getElementById('detailType').textContent = settingData.type;
            document.getElementById('detailStatus').textContent = settingData.status;

            // 2. 渲染目录（含固定定位和移动端适配）
            if (settingData.toc && settingData.toc.length > 0) {
                // 生成目录列表HTML
                let tocListHtml = '<ul class="toc-list">';
                settingData.toc.forEach(item => {
                    tocListHtml += `<li class="toc-item">
                        <a href="#${item.id}" onclick="scrollToVersion('${item.id}')">${item.name}</a>
                    </li>`;
                });
                tocListHtml += '</ul>';

                // 插入目录标题和列表（保留折叠按钮）
                tocContainer.innerHTML = `
                    <button class="toc-toggle" id="tocToggle">
                        <span>目录</span>
                        <i class="fa fa-chevron-down"></i>
                    </button>
                    <div class="toc-title">
                        <i class="fa fa-list-ul"></i> 快速导航
                    </div>
                    ${tocListHtml}
                `;

                // 重新获取DOM元素（因innerHTML重置）
                const newTocToggle = document.getElementById('tocToggle');
                const newTocList = tocContainer.querySelector('.toc-list');
                const tocLinks = tocContainer.querySelectorAll('.toc-item a');

                // 移动端折叠逻辑
                newTocToggle.addEventListener('click', () => {
                    newTocList.classList.toggle('active');
                    // 切换按钮图标
                    const icon = newTocToggle.querySelector('i');
                    if (newTocList.classList.contains('active')) {
                        icon.classList.replace('fa-chevron-down', 'fa-chevron-up');
                    } else {
                        icon.classList.replace('fa-chevron-up', 'fa-chevron-down');
                    }
                });

                // 监听滚动事件：当前可见的版本对应目录高亮
                function highlightCurrentToc() {
                    const versionSections = document.querySelectorAll('.version-section');
                    let currentVersionId = '';

                    // 检测当前滚动到的版本板块
                    versionSections.forEach(section => {
                        const sectionTop = section.offsetTop - 100; // 预留偏移量
                        const sectionHeight = section.offsetHeight;
                        if (window.scrollY >= sectionTop && window.scrollY < sectionTop + sectionHeight) {
                            currentVersionId = section.id;
                        }
                    });

                    // 高亮当前目录项，取消其他项高亮
                    tocLinks.forEach(link => {
                        link.classList.remove('active');
                        if (link.getAttribute('href') === `#${currentVersionId}`) {
                            link.classList.add('active');
                        }
                    });
                }

                // 初始执行一次，确保页面加载时高亮正确
                highlightCurrentToc();
                // 滚动时实时更新
                window.addEventListener('scroll', highlightCurrentToc);

                // 3. 渲染多版本内容（保持不变）
                const versionsContainer = document.getElementById('versionsContainer');
                versionsContainer.innerHTML = '';
                Object.keys(settingData.versions).forEach(versionId => {
                    const version = settingData.versions[versionId];
                    versionsContainer.innerHTML += `
                        <div class="version-section" id="${versionId}">
                            <h3 class="version-title">${version.title}</h3>
                            <div class="version-content">${version.description}</div>
                        </div>
                    `;
                });

            } else {
                // 无目录时的默认显示
                tocContainer.innerHTML = `
                    <div class="toc-title">
                        <i class="fa fa-list-ul"></i> 快速导航
                    </div>
                    <p>暂无目录数据</p>
                `;
            }

            // 显示内容，隐藏加载动画
            loading.style.display = 'none';
            workContent.style.display = 'block';
            workDetail.scrollIntoView({ behavior: 'smooth' });
        })
        .catch(err => {
            error.innerHTML = `<p>加载失败：${err.message}</p><p>请检查文件路径是否正确</p>`;
            error.style.display = 'block';
            loading.style.display = 'none';
        });
}

/**
 * 目录点击跳转函数（优化平滑滚动和高亮）
 * @param {string} versionId - 版本ID（与JSON中toc的id对应）
 */
function scrollToVersion(versionId) {
    const versionElement = document.getElementById(versionId);
    if (versionElement) {
        // 平滑滚动到对应版本（顶部预留20px）
        window.scrollTo({
            top: versionElement.offsetTop - 20,
            behavior: 'smooth'
        });

        // 移动端跳转后自动收起目录
        if (window.innerWidth <= 768) {
            const tocList = document.querySelector('.toc-list');
            const tocToggleIcon = document.querySelector('.toc-toggle i');
            if (tocList.classList.contains('active')) {
                tocList.classList.remove('active');
                tocToggleIcon.classList.replace('fa-chevron-up', 'fa-chevron-down');
            }
        }
    }
}
    </script>
</body>
</html>
